----
=Плагин autotools=
----

<wiki:toc />

== Описание ==

Плагин предоставляет некоторые возможности по автоматизации.
Пока реализованы следующие функции:
 * *АвтоМетки* - автоматическое формирование меток при добавлении нового торрента через веб-интерфейс.
 * *АвтоПеремещение* - автоматическое перенесение файлов данных торрента в другой каталог после полного завершения закачки.
 * *АвтоДобавление* - автоматическое добавление торрентов с формированием желаемой структуры каталогов сохраняемых данных.<br/>
 Аналог [http://libtorrent.rakshasa.no/wiki/RTorrentCommonTasks#Watchadirectoryfortorrents watch directory].

== АвтоМетки ==

  Принцип формирования метки:
 * Метка формируется по шаблону, который задается в настройках плагина. Например: `"{NOW}, {DIR}"`
 * Метка формируется только в случае, если поле ввода метки в диалоге добавления торрента пустое.

Реализованы следующие переменные шаблона:
 * *{DIR}*: Если в `rtorrent.rc` задана переменная `directory = /usr/p2p/downloads`<br/>
  и новый торрент сохраняется в `/usr/p2p/downloads/Video/DVD/movie.avi`,<br/>
  то в качестве данной переменной подставится `"Video/DVD"`.

 * *{TRACKER}*:
  В качестве данной переменной подставится имя трекера.

 * *{NOW}*:
  В качестве данной переменной подставится текущая дата. Для формирования<br/>
  даты используется функция *strftime()*. Формат даты по-умолчанию: `%Y-%m-%d`.<br/>
  Возможно задать свой формат даты следующим способом: `{NOW[:<format>]}`,<br/>
  например, `{NOW:%Y-%m-%d %H:%M}`

  
== АвтоПеремещение ==

Скачанные файлы торрента переносятся в каталог, указаный в конфигурации, с сохранением структуры каталогов относительно директории, указанной в переменной `directory` файла `rtorrent.rc` и уже оттуда запускаются на раздачу.

Например:
 Если в `rtorrent.rc` задана переменная `directory = /usr/p2p/downloads`,<br/>
 а в качестве каталога для готовых закачек указан каталог `/media/p2p`,<br/>
 то файлы загружавшиеся в `/usr/p2p/downloads/Video/Movie/*.avi` будут перемещены в `/media/p2p/Video/Movie/*.avi` после завершения закачки.

Планировалось применять плагин в случае, когда в качестве каталога для готовых закачек монтируется другой диск или SMB ресурс с общим доступом. 

== АвтоДобавление ==

  Файлы `.torrent` размещаются в подкаталогах желаемой структуры относительно некоего базового каталога. Этот базовый каталог задается в настройках плагина.
  
  Плагин периодически производит поиск `.torrent` файлов в его подкаталогах и, при обнаружении файлов, добавляет их в *rTorrent*. При этом, при сохранении данных торрента будет сформирована аналогичная структура каталогов, но уже относительно каталога, указанного в переменной `directory` файла `rtorrent.rc`.
  
  При ошибке добавления торрента, файл `.torrent` будет переименован в `.torrent.fail`


Некоторые особенности:

 * Плагин корректно обрабатывает ситуацию, когда файлы разных торрентов сохраняются в один каталог - делается перенос файлов по списку торрента, а не просто перенос базового каталога.
 * Если в каталоге для загруженных файлов окажутся файлы с такими же именами, как у завершившегося торрента, то они будут перезаписаны.
 * Плагин встраивается в rTorrent при загрузке веб-интерфейса. Если, при неактивном веб-интерфейсе, произойдет рестарт rTorrent-а, то плагин не переподключится. Если хочется избежать этого, то нужно добавить в конфигурационный файл rTorrent [Plugins#%D0%90%D0%B2%D1%82%D0%BE%D1%81%D1%82%D0%B0%D1%80%D1%82_%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%BE%D0%B2 специально обученную строчку].
 * Для удобства выбора каталога для завершенных закачек на хосте рекомендуется установить сервисный плагин [Plugin_getdir _getdir], тогда появится возможность навигации по файловой системе хоста.

