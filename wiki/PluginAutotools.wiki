#summary Описание плагина *Autotools*

== Введение ==

Плагин предоставляет некоторые возможности по автоматизации.
Пока реализованы следующие функции:
 * *AutoLabel* автоматическое формирование меток при добавлении нового торрента через веб-интерфейс.

 * *AutoMove* автоматическое перенесение файлов данных торрента в другой каталог после полного завершения закачки.

----

== AutoLabel ==
Метка автоматически формируется, если:
 * поле ввода метки в диалоге добавления торрента пустое,
 * место, куда предполагается сохранять данные торрента является подкаталогом для каталога, указанного в переменной *"directory"* файла *rtorrent.rc*.

Принцип формирования метки:

 * Если в *rtorrent.rc* задана переменная *"directory = /usr/p2p/downloads"*
 * и новый торрент сохраняется в */usr/p2p/downloads/Video/DVD/movie.avi*,
 * то в качестве метки подставится *"Video/DVD"*.

----

== AutoMove ==
Скачанные файлы торрента переносятся в каталог, указаный в конфигурации, с сохранением структуры каталогов относительно директории, указанной в переменной *"directory"* файла *"rtorrent.rc"* и уже оттуда запускаются на раздачу.

Например:
 * Если в *rtorrent.rc* задана переменная *"directory = /usr/p2p/downloads"*,
 * а в качестве каталога для готовых закачек указан каталог *"/media/p2p"*,
 * то файлы загружавшиеся в *"/usr/p2p/downloads/Video/Movie/`*`.avi"* будут перемещены в *"/media/p2p/Video/Movie/`*`.avi"* после завершения закачки.

Планировалось применять плагин в случае, когда в качестве каталога для готовых закачек монтируется другой диск или SMB ресурс с общим доступом. Данное решение работает на FreeBSD, но, по мнению *Novik*, _"под ядром 2.4 (какое имеет место быть, например, на роутере), раздача с smb и nfs монтированных разделов идти не будет. Вызов mmap, который используется rtorrent на данных fs под данным ядром не работает"_.

Некоторые особенности:

 * Плагин корректно обрабатывает ситуацию, когда файлы разных торрентов сохраняются в один каталог - делается перенос файлов по списку торрента, а не просто перенос базового каталога.

 * Если в каталоге для загруженных файлов окажутся файлы с такими же именами, как у завершившегося торрента, то они будут перезаписаны.

 * Плагин встраивается в *rTorrent* при загрузке веб-интерфейса. Если, при неактивном веб-интерфейсе, произойдет рестарт *rTorrent*-а, то плагин не переподключится. Если хочется избежать этого, то нужно в конфигурации *rtorrent.rc* прописать примерно следующее (в одну строчку):

{{{
*system.method.set_key = event.download.finished,automove, "execute={full_path_to_plugins/autotools/move.sh,full_path_to_php,$d.get_hash=}"*
}}}

 * имя события нужно оставить таким же (*"automove"*), иначе при запуске веб-морды установится вторая копия обработчика.

 * Для удобства выбора каталога для завершенных закачек на хосте рекомендуется установить сервисный плагин *`_`getdir*, тогда появится возможность навигации по файловой системе хоста.

----